<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="Catálogo de teléfonos móviles en Digital Swap. Encuentra los mejores smartphones de las marcas más populares." />
  <meta name="keywords" content="teléfonos, smartphones, móviles, digital swap, tecnología" />
  <meta name="author" content="Digital Swap" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#3b82f6" />
  <meta property="og:title" content="Teléfonos - Digital Swap" />
  <meta property="og:description" content="Catálogo de teléfonos móviles en Digital Swap" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://digitalswap.com/telefon.html" />
  <meta property="og:image" content="https://digitalswap.com/logo.png" />
  <link rel="icon" type="image/x-icon" href="logo.png" />
  <link rel="apple-touch-icon" href="logo.png" />
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Digital Swap" />
  <title>Catálogo de Teléfonos - Digital Swap</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    body {
      background-image: url('https://img.freepik.com/vector-premium/fondo-vector-monocromo-blanco-abstracto-folleto-diseno-folleto-sitio-web-fondo-pantalla-blanco-geometrico-pagina-inicio-presentacion-certificado_249611-5879.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    .product-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .filter-active {
            background-color: #3b82f6;
      color: white;
    }

    .notification {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

        .modal {
            animation: fadeIn 0.3s ease-out;
    }

        @keyframes fadeIn {
      from {
        opacity: 0;
                transform: scale(0.9);
      }
      to {
        opacity: 1;
                transform: scale(1);
      }
    }

    /* Estilos específicos para móviles */
    @media (max-width: 768px) {
      .product-card {
        margin-bottom: 1rem;
      }
      
      .product-card img {
        height: 200px !important;
      }
      
      .header-buttons {
        gap: 0.5rem;
      }
      
      .search-container {
        flex-direction: column;
        gap: 1rem;
      }
      
      .filter-buttons {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .filter-buttons button {
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
      }
      
      .product-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .modal-content {
        width: 95%;
        margin: 10% auto;
      }
      
      .cart-item, .wishlist-item {
        flex-direction: column;
        text-align: center;
      }
      
      .cart-item img, .wishlist-item img {
        margin: 0 auto 1rem;
      }
    }

    @media (max-width: 480px) {
      .product-grid {
        grid-template-columns: 1fr;
      }
      
      .header-title {
        font-size: 1.125rem;
      }
      
      .product-card h4 {
        font-size: 0.875rem;
      }
      
      .product-card p {
        font-size: 0.75rem;
      }
    }

    /* Mejoras de accesibilidad para móviles */
    @media (max-width: 768px) {
      button, input, select {
        min-height: 44px; /* Tamaño mínimo para toque */
      }
      
      .product-card {
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }
      
      .product-card:active {
        transform: scale(0.98);
      }
    }

    /* Optimizaciones de rendimiento para móviles */
    @media (max-width: 768px) {
      .product-card img {
        will-change: transform;
        backface-visibility: hidden;
      }
      
      .modal {
        -webkit-overflow-scrolling: touch;
      }
    }
  </style>
</head>

<body class="bg-gray-100 font-sans">
    <!-- Header -->
  <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <img src="logo.png" alt="Digital Swap" class="h-8 w-auto mr-3">
                    <h1 class="text-xl font-bold text-gray-900">Digital Swap</h1>
        </div>
        <div class="flex items-center space-x-4 header-buttons">
                    <button id="cartBtn" class="relative p-2 text-gray-600 hover:text-blue-600 transition-colors" aria-label="Ver carrito">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cartCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="favoritesBtn" class="relative p-2 text-gray-600 hover:text-red-600 transition-colors" aria-label="Ver favoritos">
                        <i class="fas fa-heart text-xl"></i>
                        <span id="favoritesCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
          </button>
                    <button id="comparisonBtn" class="relative p-2 text-gray-600 hover:text-green-600 transition-colors" aria-label="Comparar productos">
                        <i class="fas fa-balance-scale text-xl"></i>
                        <span id="comparisonCount" class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
          </button>
        </div>
      </div>
    </div>
  </header>

    <!-- Barra de búsqueda -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex gap-4 search-container">
                <div class="flex-1 relative">
                    <input type="text" id="searchInput" placeholder="Buscar teléfonos..." 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           aria-label="Buscar teléfonos">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
                <button id="clearFilters" class="px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors" aria-label="Limpiar filtros">
                    <i class="fas fa-times mr-2"></i>Limpiar filtros
            </button>
        </div>
      </div>
    </div>

    <div class="flex max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
      <!-- Sidebar filtros -->
        <aside class="w-64 bg-white rounded-lg shadow p-4 h-fit">
            <h2 class="text-lg font-semibold mb-4">Filtrar por</h2>

            <!-- Filtro de precio -->
        <div class="mb-6">
          <h3 class="font-medium mb-2">Precio</h3>
          <div class="flex gap-2 mb-2">
                    <input type="number" id="minPrice" placeholder="$ Mínimo" class="border w-full p-2 rounded text-sm">
                    <input type="number" id="maxPrice" placeholder="$ Máximo" class="border w-full p-2 rounded text-sm">
          </div>
                <button id="applyPriceFilter" class="w-full bg-blue-600 text-white py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                    Aplicar
                </button>
        </div>

            <!-- Filtro de marca -->
        <div class="mb-6">
                <h3 class="font-medium mb-2">Marca</h3>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" class="brand-filter mr-2" value="Apple">
                        Apple
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="brand-filter mr-2" value="Samsung">
                        Samsung
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="brand-filter mr-2" value="Xiaomi">
                        Xiaomi
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="brand-filter mr-2" value="Huawei">
                        Huawei
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="brand-filter mr-2" value="Google">
                        Google
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="brand-filter mr-2" value="OnePlus">
                        OnePlus
                    </label>
          </div>
        </div>

            <!-- Filtro de características -->
        <div class="mb-6">
                <h3 class="font-medium mb-2">Características</h3>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="5G">
                        5G
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Cámara Pro">
                        Cámara Pro
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Pantalla AMOLED">
                        Pantalla AMOLED
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Carga Rápida">
                        Carga Rápida
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Resistente al Agua">
                        Resistente al Agua
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Lector de Huellas">
                        Lector de Huellas
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Face ID">
                        Face ID
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="feature-filter mr-2" value="Wireless Charging">
                        Carga Inalámbrica
                    </label>
          </div>
        </div>

            <!-- Filtro de ofertas -->
        <div class="mb-6">
          <h3 class="font-medium mb-2">Ofertas</h3>
          <label class="flex items-center">
                    <input type="checkbox" id="offersFilter" class="mr-2">
                    Solo ofertas
          </label>
        </div>

            <!-- Contador de filtros activos -->
            <div id="activeFiltersCount" class="text-sm text-gray-600 mb-4 hidden">
                <span id="filtersCount">0</span> filtros activos
            </div>

            <!-- Ordenamiento -->
        <div class="mb-6">
                <h3 class="font-medium mb-2">Ordenar por</h3>
                <select id="sortSelect" class="w-full p-2 border rounded text-sm">
                    <option value="">Sin ordenar</option>
                    <option value="price-asc">Precio: Menor a Mayor</option>
                    <option value="price-desc">Precio: Mayor a Menor</option>
                    <option value="name-asc">Nombre: A-Z</option>
                    <option value="name-desc">Nombre: Z-A</option>
                </select>
        </div>
      </aside>

      <!-- Productos -->
        <main class="flex-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 ml-6">
            <!-- Los productos se generarán dinámicamente con JavaScript -->
        </main>
          </div>

    <!-- Modal del carrito -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto modal">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold">Carrito de Compras</h3>
                    <button id="closeCartModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
            </button>
              </div>
                <div id="cartContent" class="p-6">
                    <!-- Contenido del carrito -->
              </div>
            </div>
            </div>
          </div>

    <!-- Modal de favoritos -->
    <div id="favoritesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto modal">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold">Mis Favoritos</h3>
                    <button id="closeFavoritesModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
            </button>
              </div>
                <div id="favoritesContent" class="p-6">
                    <!-- Contenido de favoritos -->
              </div>
            </div>
            </div>
          </div>

    <!-- Modal de comparación -->
    <div id="comparisonModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto modal">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold">Comparar Productos</h3>
                    <button id="closeComparisonModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
            </button>
              </div>
                <div id="comparisonContent" class="p-6">
                    <!-- Contenido de comparación -->
              </div>
            </div>
            </div>
          </div>

    <!-- Notificaciones -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Modal de Detalles del Producto -->
<div id="modalDetalles" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6 relative modal">
      <button id="cerrarModalDetalles" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      <img id="modalImg" src="" alt="Imagen del producto" class="w-40 h-40 object-contain mx-auto mb-4 rounded">
      <h2 id="modalNombre" class="text-xl font-bold mb-2 text-center"></h2>
      <p id="modalSubtitulo" class="text-gray-600 text-center mb-2"></p>
      <p id="modalPrecio" class="text-lg font-bold text-blue-600 text-center mb-2"></p>
      <p id="modalCaracteristicas" class="text-sm text-gray-500 text-center mb-2"></p>
    </div>
  </div>
</div>

<script>
        // Datos de productos
        const products = [
            {
                id: 1,
                name: "iPhone 15 Pro Max",
                subtitle: "Apple - 256GB - Titanio Natural",
                price: 29999,
                originalPrice: 32999,
                weeklyPrice: 1500,
                image: "Imagenes/Telefonia.png",
                brand: ["Apple"],
                features: ["5G", "Cámara Pro", "Face ID", "Carga Rápida", "Resistente al Agua"],
                onSale: true
            },
            {
                id: 2,
                name: "Samsung Galaxy S24 Ultra",
                subtitle: "Samsung - 256GB - Negro",
                price: 24999,
                originalPrice: 27999,
                weeklyPrice: 1250,
                image: "Imagenes/samsu.png",
                brand: ["Samsung"],
                features: ["5G", "Cámara Pro", "Pantalla AMOLED", "Carga Rápida", "Lector de Huellas", "Resistente al Agua"],
                onSale: true
            },
            {
                id: 3,
                name: "Xiaomi 14 Pro",
                subtitle: "Xiaomi - 256GB - Verde",
                price: 18999,
                originalPrice: 21999,
                weeklyPrice: 950,
                image: "Imagenes/xiover.png",
                brand: ["Xiaomi"],
                features: ["5G", "Cámara Pro", "Pantalla AMOLED", "Carga Rápida", "Lector de Huellas"],
                onSale: true
            },
            {
                id: 4,
                name: "Google Pixel 8 Pro",
                subtitle: "Google - 128GB - Azul",
                price: 15999,
                originalPrice: 18999,
                weeklyPrice: 800,
                image: "Imagenes/gloazul.png",
                brand: ["Google"],
                features: ["5G", "Cámara Pro", "Carga Rápida", "Resistente al Agua", "Lector de Huellas"],
                onSale: true
            },
            {
                id: 5,
                name: "OnePlus 12",
                subtitle: "OnePlus - 256GB - Negro",
                price: 17999,
                originalPrice: 17999,
                weeklyPrice: 900,
                image: "Imagenes/one.png",
                brand: ["OnePlus"],
                features: ["5G", "Cámara Pro", "Pantalla AMOLED", "Carga Rápida", "Lector de Huellas"],
                onSale: false
            },
            {
                id: 6,
                name: "Huawei P60 Pro",
                subtitle: "Huawei - 512GB - Blanco",
                price: 21999,
                originalPrice: 21999,
                weeklyPrice: 1100,
                image: "Imagenes/blanco.png",
                brand: ["Huawei"],
                features: ["5G", "Cámara Pro", "Pantalla AMOLED", "Carga Rápida", "Resistente al Agua"],
                onSale: false
            },
            {
                id: 7,
                name: "iPhone 15",
                subtitle: "Apple - 128GB - Azul",
                price: 19999,
                originalPrice: 22999,
                weeklyPrice: 1000,
                image: "Imagenes/phazul.png",
                brand: ["Apple"],
                features: ["5G", "Cámara Pro", "Face ID", "Carga Rápida", "Resistente al Agua"],
                onSale: true
            },
            {
                id: 8,
                name: "Samsung Galaxy A55",
                subtitle: "Samsung - 128GB - Verde",
                price: 8999,
                originalPrice: 8999,
                weeklyPrice: 450,
                image: "Imagenes/tever.png",
                brand: ["Samsung"],
                features: ["5G", "Pantalla AMOLED", "Carga Rápida", "Lector de Huellas", "Resistente al Agua"],
                onSale: false
            }
        ];

        // Estado de la aplicación
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let comparisonItems = [];
        let filteredProducts = [...products];

        // Elementos del DOM
        const mainContainer = document.querySelector('main');
        const searchInput = document.getElementById('searchInput');
        const clearFiltersBtn = document.getElementById('clearFilters');
        const cartBtn = document.getElementById('cartBtn');
        const favoritesBtn = document.getElementById('favoritesBtn');
        const cartCount = document.getElementById('cartCount');
        const favoritesCount = document.getElementById('favoritesCount');
        const cartModal = document.getElementById('cartModal');
        const closeCartModal = document.getElementById('closeCartModal');
        const cartContent = document.getElementById('cartContent');
        const favoritesModal = document.getElementById('favoritesModal');
        const closeFavoritesModal = document.getElementById('closeFavoritesModal');
        const favoritesContent = document.getElementById('favoritesContent');
        const comparisonModal = document.getElementById('comparisonModal');
        const closeComparisonModal = document.getElementById('closeComparisonModal');
        const comparisonContent = document.getElementById('comparisonContent');
        const comparisonBtn = document.getElementById('comparisonBtn');
        const comparisonCount = document.getElementById('comparisonCount');
        const sortSelect = document.getElementById('sortSelect');
        const notifications = document.getElementById('notifications');

        // Funciones de utilidad
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification bg-${type === 'success' ? 'green' : 'red'}-500 text-white px-4 py-2 rounded-lg shadow-lg`;
            notification.textContent = message;
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Función para redirigir a tienda externa
        function redirectToProduct(productName) {
            try {
                // Usar la función de configuración si está disponible
                if (window.DigitalSwapUtils && window.DigitalSwapUtils.redirectToExternalStore) {
                    window.DigitalSwapUtils.redirectToExternalStore('MERCADO_LIBRE', productName);
                } else {
                    // Fallback si no está disponible la configuración
                    const searchQuery = encodeURIComponent(productName);
                    const mercadoLibreUrl = `https://www.mercadolibre.com.mx/search?q=${searchQuery}`;
                    window.open(mercadoLibreUrl, '_blank');
                    
                    // Mostrar notificación
                    showNotification(`Redirigiendo a Mercado Libre para buscar: ${productName}`, 'info');
                }
            } catch (error) {
                console.error('Error al redirigir:', error);
                showNotification('Error al redirigir a la tienda externa', 'error');
            }
        }

        // Función para abrir página de detalles del producto
        function openProductDetails(productId, productName, productPrice, productImage) {
            try {
                // Redirigir directamente a la página de detalles con el ID del producto
                const detailUrl = `producto-detalle.html?id=${productId}`;
                
                // Redirigir a la página de detalles
                window.location.href = detailUrl;
                
                // Mostrar notificación
                showNotification(`Abriendo detalles de: ${productName}`, 'info');
            } catch (error) {
                console.error('Error al abrir detalles del producto:', error);
                showNotification('Error al abrir detalles del producto', 'error');
            }
        }

        function updateCounters() {
            cartCount.textContent = cart.length;
            favoritesCount.textContent = favorites.length;
            comparisonCount.textContent = comparisonItems.length;
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN'
            }).format(price);
        }

        // Renderizar productos
        function renderProducts() {
            if (filteredProducts.length === 0) {
                mainContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">No se encontraron productos</h3>
                        <p class="text-gray-500">Intenta ajustar los filtros de búsqueda</p>
              </div>
                `;
                return;
            }

            mainContainer.innerHTML = filteredProducts.map(product => `
                <div class="product-card bg-white rounded-lg shadow p-4 flex flex-col h-full">
                    <div class="relative mb-3">
                        <img src="${product.image}" 
                             alt="${product.name}" 
                             class="w-full h-48 object-cover rounded cursor-pointer hover:opacity-90 transition-opacity" 
                             data-id="${product.id}"
                             onclick="openProductDetails(${product.id}, '${product.name}', ${product.price}, '${product.image}')"
                             onerror="this.src='https://via.placeholder.com/300x200?text=Imagen+no+disponible'">
                        ${product.onSale ? '<span class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs font-medium">OFERTA</span>' : ''}
                        <button onclick="toggleFavorite(${product.id})" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors">
                            <i class="fas fa-heart ${favorites.includes(product.id) ? 'text-red-500' : ''}"></i>
                        </button>
                        <button onclick="redirectToProduct('${product.name}')" class="absolute top-2 right-10 text-gray-400 hover:text-blue-500 transition-colors" title="Ver en Mercado Libre">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                    </div>
                    <h4 class="text-sm font-medium mb-1 line-clamp-2">${product.name}</h4>
                    <p class="text-gray-500 text-xs mb-2">${product.subtitle}</p>
                    <p class="text-gray-500 text-xs mb-1">Desde $${product.weeklyPrice} quincenales</p>
                    <div class="flex items-center gap-2 mb-3">
                        <p class="text-gray-800 font-bold">${formatPrice(product.price)}</p>
                        ${product.onSale ? `<p class="text-gray-400 text-sm line-through">${formatPrice(product.originalPrice)}</p>` : ''}
                    </div>
                    <button onclick="addToCart(${product.id})" class="border border-blue-600 text-blue-600 py-2 rounded hover:bg-blue-50 mb-2 transition-colors">
                        Agregar al carrito
                    </button>
                    <label class="flex items-center text-blue-600 text-xs cursor-pointer">
                        <input type="checkbox" onchange="toggleComparison(${product.id})" class="mr-2">
                        Comparar
                    </label>
                </div>
            `).join('');
        }

        // Funciones de carrito
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity = (existingItem.quantity || 1) + 1;
                } else {
                    product.quantity = 1;
                    cart.push(product);
                }
                saveCart();
                updateCounters();
                showNotification(`${product.name} agregado al carrito`);
            }
        }

        function removeFromCart(productId) {
            const index = cart.findIndex(item => item.id === productId);
            if (index > -1) {
                const product = cart[index];
                cart.splice(index, 1);
                saveCart();
                updateCounters();
                renderCartModal();
                showNotification(`${product.name} removido del carrito`);
            }
        }

        function updateCartQuantity(productId, quantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                if (quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    item.quantity = quantity;
                    saveCart();
                    updateCounters();
                    renderCartModal();
                }
            }
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function renderCartModal() {
            if (cart.length === 0) {
                cartContent.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">Tu carrito está vacío</h3>
                        <p class="text-gray-500">Agrega algunos productos para comenzar</p>
              </div>
                `;
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
            
            cartContent.innerHTML = `
                <div class="space-y-4">
                    ${cart.map(item => `
                        <div class="flex items-center gap-4 p-4 border rounded-lg">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1">
                                <h4 class="font-medium">${item.name}</h4>
                                <p class="text-sm text-gray-600">${item.subtitle}</p>
                                <p class="font-bold">${formatPrice(item.price)}</p>
            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="updateCartQuantity(${item.id}, ${(item.quantity || 1) - 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                    <i class="fas fa-minus text-xs"></i>
                                </button>
                                <span class="w-8 text-center">${item.quantity || 1}</span>
                                <button onclick="updateCartQuantity(${item.id}, ${(item.quantity || 1) + 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                    <i class="fas fa-plus text-xs"></i>
              </button>
                                <button onclick="removeFromCart(${item.id})" class="ml-4 text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
                    `).join('')}
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold">Total:</span>
                            <span class="text-lg font-bold">${formatPrice(total)}</span>
                        </div>
                        <button onclick="checkout()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Proceder al pago
            </button>
              </div>
            </div>
            `;
        }

        function checkout() {
            showNotification('¡Gracias por tu compra! Redirigiendo al pago...', 'success');
            setTimeout(() => {
                cart = [];
                saveCart();
                updateCounters();
                cartModal.classList.add('hidden');
            }, 2000);
        }

        // Funciones de favoritos
        function toggleFavorite(productId) {
            const index = favorites.indexOf(productId);
            if (index > -1) {
                favorites.splice(index, 1);
                showNotification('Removido de favoritos');
            } else {
                favorites.push(productId);
                showNotification('Agregado a favoritos');
            }
            saveFavorites();
            updateCounters();
            renderProducts();
        }

        function removeFromFavorites(productId) {
            const index = favorites.indexOf(productId);
            if (index > -1) {
                favorites.splice(index, 1);
                saveFavorites();
                updateCounters();
                renderFavoritesModal();
                showNotification('Removido de favoritos');
            }
        }

        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function renderFavoritesModal() {
            if (favorites.length === 0) {
                favoritesContent.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-heart text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">No tienes favoritos</h3>
                        <p class="text-gray-500">Agrega algunos productos a tus favoritos</p>
                    </div>
                `;
                return;
            }

            const favoriteProducts = products.filter(p => favorites.includes(p.id));
            
            favoritesContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${favoriteProducts.map(product => `
                        <div class="flex items-center gap-4 p-4 border rounded-lg">
                            <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1">
                                <h4 class="font-medium">${product.name}</h4>
                                <p class="text-sm text-gray-600">${product.subtitle}</p>
                                <p class="font-bold">${formatPrice(product.price)}</p>
                            </div>
                            <div class="flex flex-col gap-2">
                                <button onclick="addToCart(${product.id})" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    Agregar al carrito
              </button>
                                <button onclick="removeFromFavorites(${product.id})" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-700">
                                    Remover
              </button>
            </div>
          </div>
                    `).join('')}
                </div>
            `;
        }

        // Funciones de comparación
        function toggleComparison(productId) {
            const index = comparisonItems.indexOf(productId);
            if (index > -1) {
                comparisonItems.splice(index, 1);
            } else {
                if (comparisonItems.length >= 3) {
                    showNotification('Máximo 3 productos para comparar', 'error');
                    return;
                }
                comparisonItems.push(productId);
            }
            renderComparisonModal();
        }

        function renderComparisonModal() {
            if (comparisonItems.length === 0) {
                comparisonContent.innerHTML = '<p class="text-gray-500">Selecciona productos para comparar</p>';
                return;
            }

            const itemsToCompare = products.filter(p => comparisonItems.includes(p.id));
            const gridCols = itemsToCompare.length === 1 ? 'grid-cols-1' : 
                            itemsToCompare.length === 2 ? 'grid-cols-2' : 'grid-cols-3';
            
            comparisonContent.innerHTML = `
                <div class="grid ${gridCols} gap-4">
                    ${itemsToCompare.map(product => `
                        <div class="text-center">
                            <img src="${product.image}" alt="${product.name}" class="w-32 h-32 object-cover mx-auto mb-2">
                            <h4 class="font-medium">${product.name}</h4>
                            <p class="text-sm text-gray-600">${product.subtitle}</p>
                            <p class="font-bold text-lg">${formatPrice(product.price)}</p>
                            <p class="text-sm text-gray-500">Desde $${product.weeklyPrice} quincenales</p>
                            <p class="text-xs text-gray-400">Marca: ${product.brand.join(', ')}</p>
                            <p class="text-xs text-gray-400">Características: ${product.features.join(', ')}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Filtros
        function applyFilters() {
            let filtered = [...products];

            // Filtro de búsqueda
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.subtitle.toLowerCase().includes(searchTerm)
                );
            }

            // Filtro de precio
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            if (minPrice && !isNaN(minPrice)) {
                filtered = filtered.filter(product => product.price >= parseInt(minPrice));
            }
            if (maxPrice && !isNaN(maxPrice)) {
                filtered = filtered.filter(product => product.price <= parseInt(maxPrice));
            }

            // Filtro de marca
            const selectedBrands = Array.from(document.querySelectorAll('.brand-filter:checked')).map(cb => cb.value);
            if (selectedBrands.length > 0) {
                filtered = filtered.filter(product => 
                    selectedBrands.some(brand => product.brand.includes(brand))
                );
            }

            // Filtro de características
            const selectedFeatures = Array.from(document.querySelectorAll('.feature-filter:checked')).map(cb => cb.value);
            if (selectedFeatures.length > 0) {
                filtered = filtered.filter(product => 
                    selectedFeatures.some(feature => product.features.includes(feature))
                );
            }

            // Filtro de ofertas
            if (document.getElementById('offersFilter').checked) {
                filtered = filtered.filter(product => product.onSale);
            }

            // Ordenamiento
            const sortValue = sortSelect.value;
            if (sortValue) {
                filtered.sort((a, b) => {
                    switch (sortValue) {
                        case 'price-asc':
                            return a.price - b.price;
                        case 'price-desc':
                            return b.price - a.price;
                        case 'name-asc':
                            return a.name.localeCompare(b.name);
                        case 'name-desc':
                            return b.name.localeCompare(a.name);
                        default:
                            return 0;
                    }
                });
            }

            filteredProducts = filtered;
            renderProducts();
            updateActiveFiltersCount();
        }

        function updateActiveFiltersCount() {
            const searchValue = searchInput.value.trim();
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            const selectedBrands = Array.from(document.querySelectorAll('.brand-filter:checked')).map(cb => cb.value);
            const selectedFeatures = Array.from(document.querySelectorAll('.feature-filter:checked')).map(cb => cb.value);
            const offersOnly = document.getElementById('offersFilter').checked;
            const sortValue = sortSelect.value;

            const activeFilters = [
                searchValue,
                minPrice,
                maxPrice,
                ...selectedBrands,
                ...selectedFeatures,
                offersOnly,
                sortValue
            ].filter(Boolean).length;

            const countElement = document.getElementById('activeFiltersCount');
            const countText = document.getElementById('filtersCount');
            
            if (activeFilters > 0) {
                countText.textContent = activeFilters;
                countElement.classList.remove('hidden');
            } else {
                countElement.classList.add('hidden');
            }
        }

        function clearAllFilters() {
            searchInput.value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.querySelectorAll('.brand-filter, .feature-filter').forEach(cb => cb.checked = false);
            document.getElementById('offersFilter').checked = false;
            sortSelect.value = '';
            applyFilters();
            showNotification('Filtros limpiados', 'success');
        }

        // Event listeners
        searchInput.addEventListener('input', applyFilters);
        clearFiltersBtn.addEventListener('click', clearAllFilters);
        document.querySelectorAll('.brand-filter, .feature-filter').forEach(cb => cb.addEventListener('change', applyFilters));
        document.getElementById('offersFilter').addEventListener('change', applyFilters);
        document.getElementById('applyPriceFilter').addEventListener('click', applyFilters);
        sortSelect.addEventListener('change', applyFilters);

        // Event listeners para modales
        closeCartModal.addEventListener('click', () => {
            cartModal.classList.add('hidden');
        });

        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                cartModal.classList.add('hidden');
            }
        });

        closeFavoritesModal.addEventListener('click', () => {
            favoritesModal.classList.add('hidden');
        });

        favoritesModal.addEventListener('click', (e) => {
            if (e.target === favoritesModal) {
                favoritesModal.classList.add('hidden');
            }
        });

        closeComparisonModal.addEventListener('click', () => {
            comparisonModal.classList.add('hidden');
        });

        comparisonModal.addEventListener('click', (e) => {
            if (e.target === comparisonModal) {
                comparisonModal.classList.add('hidden');
            }
        });

        // Botones del header
        cartBtn.addEventListener('click', () => {
            renderCartModal();
            cartModal.classList.remove('hidden');
        });

        favoritesBtn.addEventListener('click', () => {
            renderFavoritesModal();
            favoritesModal.classList.remove('hidden');
        });

        comparisonBtn.addEventListener('click', () => {
            if (comparisonItems.length > 0) {
                renderComparisonModal();
                comparisonModal.classList.remove('hidden');
            } else {
                showNotification('Selecciona productos para comparar', 'error');
            }
        });

        // Inicialización
        renderProducts();
        updateCounters();
        renderCartModal();
        renderFavoritesModal();

        // Optimizaciones específicas para móviles
        function initMobileOptimizations() {
            // Prevenir zoom en inputs en iOS
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    if (window.innerWidth <= 768) {
                        this.style.fontSize = '16px'; // Previene zoom en iOS
                    }
                });
            });

            // Mejorar scroll en móviles
            if ('ontouchstart' in window) {
                document.body.style.webkitOverflowScrolling = 'touch';
            }

            // Optimizar imágenes para móviles
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('load', function() {
                    this.style.opacity = '1';
                });
                img.style.opacity = '0';
                img.style.transition = 'opacity 0.3s ease';
            });

            // Mejorar botones para toque
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                button.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                });
            });

            // Gestión de orientación del dispositivo
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });
        }

        // Inicializar optimizaciones móviles
        if (window.innerWidth <= 768) {
            initMobileOptimizations();
        }

        // Detectar cambios de tamaño de ventana
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                initMobileOptimizations();
            }
        });

        // --- MODAL DETALLES PRODUCTO ---
        // Modal de detalles de producto
        function mostrarDetallesProductoPorId(id) {
            try {
                const product = products.find(p => p.id == id);
                if (!product) {
                    console.error('Producto no encontrado:', id);
                    return;
                }
                
                const modalNombre = document.getElementById('modalNombre');
                const modalSubtitulo = document.getElementById('modalSubtitulo');
                const modalPrecio = document.getElementById('modalPrecio');
                const modalImg = document.getElementById('modalImg');
                const modalCaracteristicas = document.getElementById('modalCaracteristicas');
                const modalDetalles = document.getElementById('modalDetalles');
                
                if (modalNombre) modalNombre.textContent = product.name;
                if (modalSubtitulo) modalSubtitulo.textContent = product.subtitle || '';
                if (modalPrecio) modalPrecio.textContent = 'Precio: ' + formatPrice(product.price);
                if (modalImg) modalImg.src = product.image;
                if (modalCaracteristicas) modalCaracteristicas.textContent = product.features ? 'Características: ' + product.features.join(', ') : '';
                if (modalDetalles) modalDetalles.classList.remove('hidden');
            } catch (error) {
                console.error('Error al mostrar detalles del producto:', error);
            }
        }
        // Delegación de eventos para las imágenes (solo para elementos sin onclick)
        if (mainContainer) {
          mainContainer.addEventListener('click', function(e) {
            if (e.target.tagName === 'IMG' && e.target.dataset.id && !e.target.onclick) {
              mostrarDetallesProductoPorId(e.target.dataset.id);
            }
          });
        }
        // Cerrar el modal
        const cerrarModalDetalles = document.getElementById('cerrarModalDetalles');
        if (cerrarModalDetalles) {
          cerrarModalDetalles.onclick = function() {
            const modalDetalles = document.getElementById('modalDetalles');
            if (modalDetalles) {
              modalDetalles.classList.add('hidden');
            }
          }
        }
        const modalDetalles = document.getElementById('modalDetalles');
        if (modalDetalles) {
          modalDetalles.addEventListener('click', function(e) {
            if (e.target === this) {
              this.classList.add('hidden');
            }
          });
        }
        // Cerrar con ESC
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            const modalDetalles = document.getElementById('modalDetalles');
            if (modalDetalles && !modalDetalles.classList.contains('hidden')) {
              modalDetalles.classList.add('hidden');
            }
          }
        });
        // --- FIN MODAL DETALLES PRODUCTO ---
    </script>
</body>

</html>

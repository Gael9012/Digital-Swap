<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catálogo de Videojuegos - Digital Swap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        body {
            background-image: url('https://img.freepik.com/vector-premium/fondo-vector-monocromo-blanco-abstracto-folleto-diseno-folleto-sitio-web-fondo-pantalla-blanco-geometrico-pagina-inicio-presentacion-certificado_249611-5879.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        .product-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .product-card img:hover {
            transform: scale(1.02);
            transition: transform 0.2s ease;
        }
        
        .external-link-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        
        .product-card:hover .external-link-indicator {
            opacity: 1;
        }
        
        .filter-active {
            background-color: #3b82f6;
            color: white;
        }
        
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .modal {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="bg-gray-100 font-sans">

    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 py-6 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <img src="logo.png" alt="Digital Swap" class="h-8 w-auto mr-3">
                    <h1 class="text-2xl font-bold text-white">Digital Swap</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="cartBtn" class="relative p-2 text-white hover:text-blue-200 transition-colors">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cartCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="favoritesBtn" class="relative p-2 text-white hover:text-red-200 transition-colors">
                        <i class="fas fa-heart text-xl"></i>
                        <span id="favoritesCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="comparisonBtn" class="relative p-2 text-white hover:text-green-200 transition-colors">
                        <i class="fas fa-balance-scale text-xl"></i>
                        <span id="comparisonCount" class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Barra de búsqueda -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex gap-4">
                <div class="flex-1 relative">
                    <input type="text" id="searchInput" placeholder="Buscar videojuegos..." 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                <button id="clearFilters" class="px-4 py-2 text-gray-600 hover:text-blue-600 transition-colors">
                    <i class="fas fa-times mr-2"></i>Limpiar filtros
                </button>
            </div>
        </div>
    </div>

    <div class="flex max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Sidebar filtros -->
        <aside class="w-64 bg-white rounded-lg shadow p-4 h-fit">
            <h2 class="text-lg font-semibold mb-4">Filtrar por</h2>

            <!-- Filtro de precio -->
            <div class="mb-6">
                <h3 class="font-medium mb-2">Precio</h3>
                <div class="flex gap-2 mb-2">
                    <input type="number" id="minPrice" placeholder="$ Mínimo" class="border w-full p-2 rounded text-sm">
                    <input type="number" id="maxPrice" placeholder="$ Máximo" class="border w-full p-2 rounded text-sm">
                </div>
                <button id="applyPriceFilter" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-1 rounded text-sm hover:from-blue-700 hover:to-purple-700 transition-colors">
                    Aplicar
                </button>
            </div>

            <!-- Filtro de plataforma -->
            <div class="mb-6">
                <h3 class="font-medium mb-2">Plataforma</h3>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" class="platform-filter mr-2" value="PlayStation 5">
                        PlayStation 5
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="platform-filter mr-2" value="Xbox Series X">
                        Xbox Series X
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="platform-filter mr-2" value="Nintendo Switch">
                        Nintendo Switch
                    </label>
                    
                </div>
            </div>

            <!-- Filtro de género -->
            <div class="mb-6">
                <h3 class="font-medium mb-2">Género</h3>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" class="genre-filter mr-2" value="Acción">
                        Acción
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="genre-filter mr-2" value="Aventura">
                        Aventura
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="genre-filter mr-2" value="RPG">
                        RPG
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="genre-filter mr-2" value="Carreras">
                        Carreras
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="genre-filter mr-2" value="Lucha">
                        Lucha
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="genre-filter mr-2" value="Shooter">
                        Shooter
                    </label>
                </div>
            </div>

            <!-- Filtro de ofertas -->
            <div class="mb-6">
                <h3 class="font-medium mb-2">Ofertas</h3>
                <label class="flex items-center">
                    <input type="checkbox" id="offersFilter" class="mr-2">
                    Solo ofertas
                </label>
            </div>

            <!-- Contador de filtros activos -->
            <div id="activeFiltersCount" class="text-sm text-gray-600 mb-4 hidden">
                <span id="filtersCount">0</span> filtros activos
            </div>

            <!-- Ordenamiento -->
            <div class="mb-6">
                <h3 class="font-medium mb-2">Ordenar por</h3>
                <select id="sortSelect" class="w-full p-2 border rounded text-sm">
                    <option value="">Sin ordenar</option>
                    <option value="price-asc">Precio: Menor a Mayor</option>
                    <option value="price-desc">Precio: Mayor a Menor</option>
                    <option value="name-asc">Nombre: A-Z</option>
                    <option value="name-desc">Nombre: Z-A</option>
                </select>
            </div>
        </aside>

        <!-- Productos -->
        <main class="flex-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 ml-6">
            <!-- Los productos se generarán dinámicamente con JavaScript -->
        </main>
    </div>

    <!-- Modal del carrito -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto modal">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold">Carrito de Compras</h3>
                    <button id="closeCartModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="cartContent" class="p-6">
                    <!-- Contenido del carrito -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de favoritos -->
    <div id="favoritesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto modal">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold">Mis Favoritos</h3>
                    <button id="closeFavoritesModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="favoritesContent" class="p-6">
                    <!-- Contenido de favoritos -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de comparación -->
    <div id="comparisonModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto modal">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold">Comparar Productos</h3>
                    <button id="closeComparisonModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="comparisonContent" class="p-6">
                    <!-- Contenido de comparación -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notificaciones -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Modal de Detalles del Producto -->
    <div id="modalDetalles" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg max-w-md w-full p-6 relative modal">
          <button id="cerrarModalDetalles" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
          <img id="modalImg" src="" alt="Imagen del producto" class="w-40 h-40 object-contain mx-auto mb-4 rounded">
          <h2 id="modalNombre" class="text-xl font-bold mb-2 text-center"></h2>
          <p id="modalSubtitulo" class="text-gray-600 text-center mb-2"></p>
          <p id="modalPrecio" class="text-lg font-bold text-blue-600 text-center mb-2"></p>
          <p id="modalPlataformas" class="text-sm text-gray-500 text-center mb-2"></p>
          <p id="modalGeneros" class="text-sm text-gray-500 text-center mb-2"></p>
        </div>
      </div>
    </div>

    <script>
        // Datos de productos
        const products = [
            {
                id: 1,
                name: "Tekken 8",
                subtitle: "Lucha - PlayStation 5 / Xbox Series X",
                price: 2999,
                originalPrice: 3499,
                weeklyPrice: 150,
                image: "Imagenes/Tekken.png",
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["Lucha"],
                onSale: true
            },
            {
                id: 2,
                name: "Gran Turismo 7",
                subtitle: "Carreras - PlayStation 5",
                price: 1999,
                originalPrice: 2499,
                weeklyPrice: 150,
                image: "Imagenes/Gran .png",
                platform: ["PlayStation 5"],
                genre: ["Carreras"],
                onSale: true
            },
            {
                id: 3,
                name: "Doom Eternal",
                subtitle: "Shooter - PlayStation 5 / Xbox Series X",
                price: 2599,
                originalPrice: 2999,
                weeklyPrice: 130,
                image: "Imagenes/Doom.png",
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["Shooter"],
                onSale: true
            },
            {
                id: 4,
                name: "Assassin's Creed Mirage",
                subtitle: "Acción / Sigilo - PlayStation 5 / Xbox Series X",
                price: 499,
                originalPrice: 999,
                weeklyPrice: 29,
                image: "Imagenes/mira.png",
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["Acción", "Aventura"],
                onSale: true
            },
            {
                id: 5,
                name: "Final Fantasy XVI",
                subtitle: "RPG / Aventura - PlayStation 5",
                price: 3199,
                originalPrice: 3199,
                weeklyPrice: 51,
                image: "Imagenes/Fantasy XVI.png",
                platform: ["PlayStation 5"],
                genre: ["RPG", "Aventura"],
                onSale: false
            },
            {
                id: 6,
                name: "Pokémon Scarlet & Violet",
                subtitle: "RPG - Nintendo Switch",
                price: 2799,
                originalPrice: 2799,
                weeklyPrice: 49,
                image: "Imagenes/Violet.png",
                platform: ["Nintendo Switch"],
                genre: ["RPG"],
                onSale: false
            },
            {
                id: 7,
                name: "Hogwarts Legacy",
                subtitle: "RPG / Aventura - PlayStation 5 / Xbox Series X",
                price: 1899,
                originalPrice: 2499,
                weeklyPrice: 95,
                image: "Imagenes/accion.png",
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["RPG", "Aventura"],
                onSale: true
            },
            {
                id: 8,
                name: "Mario Kart 8 Deluxe",
                subtitle: "Carreras - Nintendo Switch",
                price: 1599,
                originalPrice: 1599,
                weeklyPrice: 80,
                image: "Imagenes/karts.png",
                platform: ["Nintendo Switch"],
                genre: ["Carreras"],
                onSale: false
            }
        ];

        // Estado de la aplicación
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let comparisonItems = [];
        let filteredProducts = [...products];

        // Elementos del DOM
        const mainContainer = document.querySelector('main');
        const searchInput = document.getElementById('searchInput');
        const clearFiltersBtn = document.getElementById('clearFilters');
        const cartBtn = document.getElementById('cartBtn');
        const favoritesBtn = document.getElementById('favoritesBtn');
        const cartCount = document.getElementById('cartCount');
        const favoritesCount = document.getElementById('favoritesCount');
        const cartModal = document.getElementById('cartModal');
        const closeCartModal = document.getElementById('closeCartModal');
        const cartContent = document.getElementById('cartContent');
        const favoritesModal = document.getElementById('favoritesModal');
        const closeFavoritesModal = document.getElementById('closeFavoritesModal');
        const favoritesContent = document.getElementById('favoritesContent');
        const comparisonModal = document.getElementById('comparisonModal');
        const closeComparisonModal = document.getElementById('closeComparisonModal');
        const comparisonContent = document.getElementById('comparisonContent');
        const comparisonBtn = document.getElementById('comparisonBtn');
        const comparisonCount = document.getElementById('comparisonCount');
        const sortSelect = document.getElementById('sortSelect');
        const notifications = document.getElementById('notifications');

        // Funciones de utilidad
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification bg-${type === 'success' ? 'green' : 'red'}-500 text-white px-4 py-2 rounded-lg shadow-lg`;
            notification.textContent = message;
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Función para redirigir a Mercado Libre con detalles del producto
        function redirectToProductWithDetails(productName, productDetails = '') {
            try {
                // Construir la búsqueda para Mercado Libre
                const searchQuery = encodeURIComponent(`${productName} ${productDetails}`.trim());
                const mercadoLibreUrl = `https://www.mercadolibre.com.mx/search?q=${searchQuery}`;
                
                // Abrir en nueva pestaña
                window.open(mercadoLibreUrl, '_blank');
                
                // Mostrar notificación
                showNotification(`Redirigiendo a Mercado Libre para ver detalles de ${productName}`, 'success');
                
            } catch (error) {
                console.error('Error al redirigir a Mercado Libre:', error);
                showNotification('Error al abrir Mercado Libre', 'error');
            }
        }

        function updateCounters() {
            cartCount.textContent = cart.length;
            favoritesCount.textContent = favorites.length;
            comparisonCount.textContent = comparisonItems.length;
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN'
            }).format(price);
        }

        // Renderizar productos
        function renderProducts() {
            if (filteredProducts.length === 0) {
                mainContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">No se encontraron productos</h3>
                        <p class="text-gray-500">Intenta ajustar los filtros de búsqueda</p>
                    </div>
                `;
                return;
            }

            mainContainer.innerHTML = filteredProducts.map(product => `
                <div class="product-card bg-white rounded-lg shadow p-4 flex flex-col h-full">
                    <div class="relative mb-3">
                        <img src="${product.image}" 
                             alt="${product.name}" 
                             class="w-full h-48 object-cover rounded cursor-pointer hover:opacity-90 transition-opacity" 
                             data-id="${product.id}"
                             onclick="openProductDetails(${product.id}, '${product.name}', ${product.price}, '${product.image}')"
                             title="Haz clic para ver detalles del juego"
                             onerror="this.src='https://via.placeholder.com/300x200?text=Imagen+no+disponible'">
                        <div class="external-link-indicator">
                            <i class="fas fa-external-link-alt mr-1"></i>Ver en ML
                        </div>
                        ${product.onSale ? '<span class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs font-medium">OFERTA</span>' : ''}
                        <button onclick="toggleFavorite(${product.id})" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors">
                            <i class="fas fa-heart ${favorites.includes(product.id) ? 'text-red-500' : ''}"></i>
                        </button>
                    </div>
                    <h4 class="text-sm font-medium mb-1 line-clamp-2">${product.name}</h4>
                    <p class="text-gray-500 text-xs mb-2">${product.subtitle}</p>
                    <p class="text-gray-500 text-xs mb-1">Desde $${product.weeklyPrice} quincenales</p>
                    <div class="flex items-center gap-2 mb-3">
                        <p class="text-gray-800 font-bold">${formatPrice(product.price)}</p>
                        ${product.onSale ? `<p class="text-gray-400 text-sm line-through">${formatPrice(product.originalPrice)}</p>` : ''}
                    </div>
                    <button onclick="addToCart(${product.id})" class="border border-blue-600 text-blue-600 py-2 rounded hover:bg-blue-50 mb-2 transition-colors">
                        Agregar al carrito
                    </button>
                    <label class="flex items-center text-blue-600 text-xs cursor-pointer">
                        <input type="checkbox" onchange="toggleComparison(${product.id})" class="mr-2">
                        Comparar
                    </label>
                </div>
            `).join('');
        }

        // Funciones de carrito
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity = (existingItem.quantity || 1) + 1;
                } else {
                    product.quantity = 1;
                    cart.push(product);
                }
                saveCart();
                updateCounters();
                showNotification(`${product.name} agregado al carrito`);
            }
        }

        function removeFromCart(productId) {
            const index = cart.findIndex(item => item.id === productId);
            if (index > -1) {
                const product = cart[index];
                cart.splice(index, 1);
                saveCart();
                updateCounters();
                renderCartModal();
                showNotification(`${product.name} removido del carrito`);
            }
        }

        function updateCartQuantity(productId, quantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                if (quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    item.quantity = quantity;
                    saveCart();
                    updateCounters();
                    renderCartModal();
                }
            }
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function renderCartModal() {
            if (cart.length === 0) {
                cartContent.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">Tu carrito está vacío</h3>
                        <p class="text-gray-500">Agrega algunos productos para comenzar</p>
                    </div>
                `;
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
            
            cartContent.innerHTML = `
                <div class="space-y-4">
                    ${cart.map(item => `
                        <div class="flex items-center gap-4 p-4 border rounded-lg">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1">
                                <h4 class="font-medium">${item.name}</h4>
                                <p class="text-sm text-gray-600">${item.subtitle}</p>
                                <p class="font-bold">${formatPrice(item.price)}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="updateCartQuantity(${item.id}, ${(item.quantity || 1) - 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                    <i class="fas fa-minus text-xs"></i>
                                </button>
                                <span class="w-8 text-center">${item.quantity || 1}</span>
                                <button onclick="updateCartQuantity(${item.id}, ${(item.quantity || 1) + 1})" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                    <i class="fas fa-plus text-xs"></i>
                                </button>
                                <button onclick="removeFromCart(${item.id})" class="ml-4 text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold">Total:</span>
                            <span class="text-lg font-bold">${formatPrice(total)}</span>
                        </div>
                        <button onclick="checkout()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Proceder al pago
                        </button>
                    </div>
                </div>
            `;
        }

        function checkout() {
            showNotification('¡Gracias por tu compra! Redirigiendo al pago...', 'success');
            setTimeout(() => {
                cart = [];
                saveCart();
                updateCounters();
                cartModal.classList.add('hidden');
            }, 2000);
        }

        // Funciones de favoritos
        function toggleFavorite(productId) {
            const index = favorites.indexOf(productId);
            if (index > -1) {
                favorites.splice(index, 1);
                showNotification('Removido de favoritos');
            } else {
                favorites.push(productId);
                showNotification('Agregado a favoritos');
            }
            saveFavorites();
            updateCounters();
            renderProducts();
        }

        function removeFromFavorites(productId) {
            const index = favorites.indexOf(productId);
            if (index > -1) {
                favorites.splice(index, 1);
                saveFavorites();
                updateCounters();
                renderFavoritesModal();
                showNotification('Removido de favoritos');
            }
        }

        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function renderFavoritesModal() {
            if (favorites.length === 0) {
                favoritesContent.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-heart text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">No tienes favoritos</h3>
                        <p class="text-gray-500">Agrega algunos productos a tus favoritos</p>
                    </div>
                `;
                return;
            }

            const favoriteProducts = products.filter(p => favorites.includes(p.id));
            
            favoritesContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${favoriteProducts.map(product => `
                        <div class="flex items-center gap-4 p-4 border rounded-lg">
                            <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1">
                                <h4 class="font-medium">${product.name}</h4>
                                <p class="text-sm text-gray-600">${product.subtitle}</p>
                                <p class="font-bold">${formatPrice(product.price)}</p>
                            </div>
                            <div class="flex flex-col gap-2">
                                <button onclick="addToCart(${product.id})" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    Agregar al carrito
                                </button>
                                <button onclick="removeFromFavorites(${product.id})" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-700">
                                    Remover
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Funciones de comparación
        function toggleComparison(productId) {
            const index = comparisonItems.indexOf(productId);
            if (index > -1) {
                comparisonItems.splice(index, 1);
            } else {
                if (comparisonItems.length >= 3) {
                    showNotification('Máximo 3 productos para comparar', 'error');
                    return;
                }
                comparisonItems.push(productId);
            }
            renderComparisonModal();
        }

        function renderComparisonModal() {
            if (comparisonItems.length === 0) {
                comparisonContent.innerHTML = '<p class="text-gray-500">Selecciona productos para comparar</p>';
                return;
            }

            const itemsToCompare = products.filter(p => comparisonItems.includes(p.id));
            const gridCols = itemsToCompare.length === 1 ? 'grid-cols-1' : 
                            itemsToCompare.length === 2 ? 'grid-cols-2' : 'grid-cols-3';
            
            comparisonContent.innerHTML = `
                <div class="grid ${gridCols} gap-4">
                    ${itemsToCompare.map(product => `
                        <div class="text-center">
                            <img src="${product.image}" alt="${product.name}" class="w-32 h-32 object-cover mx-auto mb-2">
                            <h4 class="font-medium">${product.name}</h4>
                            <p class="text-sm text-gray-600">${product.subtitle}</p>
                            <p class="font-bold text-lg">${formatPrice(product.price)}</p>
                            <p class="text-sm text-gray-500">Desde $${product.weeklyPrice} quincenales</p>
                            <p class="text-xs text-gray-400">Plataformas: ${product.platform.join(', ')}</p>
                            <p class="text-xs text-gray-400">Género: ${product.genre.join(', ')}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Filtros
        function applyFilters() {
            let filtered = [...products];

            // Filtro de búsqueda
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.subtitle.toLowerCase().includes(searchTerm)
                );
            }

            // Filtro de precio
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            if (minPrice && !isNaN(minPrice)) {
                filtered = filtered.filter(product => product.price >= parseInt(minPrice));
            }
            if (maxPrice && !isNaN(maxPrice)) {
                filtered = filtered.filter(product => product.price <= parseInt(maxPrice));
            }

            // Filtro de plataforma
            const selectedPlatforms = Array.from(document.querySelectorAll('.platform-filter:checked')).map(cb => cb.value);
            if (selectedPlatforms.length > 0) {
                filtered = filtered.filter(product => 
                    selectedPlatforms.some(platform => product.platform.includes(platform))
                );
            }

            // Filtro de género
            const selectedGenres = Array.from(document.querySelectorAll('.genre-filter:checked')).map(cb => cb.value);
            if (selectedGenres.length > 0) {
                filtered = filtered.filter(product => 
                    selectedGenres.some(genre => product.genre.includes(genre))
                );
            }

            // Filtro de ofertas
            if (document.getElementById('offersFilter').checked) {
                filtered = filtered.filter(product => product.onSale);
            }

            // Ordenamiento
            const sortValue = sortSelect.value;
            if (sortValue) {
                filtered.sort((a, b) => {
                    switch (sortValue) {
                        case 'price-asc':
                            return a.price - b.price;
                        case 'price-desc':
                            return b.price - a.price;
                        case 'name-asc':
                            return a.name.localeCompare(b.name);
                        case 'name-desc':
                            return b.name.localeCompare(a.name);
                        default:
                            return 0;
                    }
                });
            }

            filteredProducts = filtered;
            renderProducts();
            updateActiveFiltersCount();
        }

        function updateActiveFiltersCount() {
            const searchValue = searchInput.value.trim();
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            const selectedPlatforms = Array.from(document.querySelectorAll('.platform-filter:checked')).map(cb => cb.value);
            const selectedGenres = Array.from(document.querySelectorAll('.genre-filter:checked')).map(cb => cb.value);
            const offersOnly = document.getElementById('offersFilter').checked;
            const sortValue = sortSelect.value;

            const activeFilters = [
                searchValue,
                minPrice,
                maxPrice,
                ...selectedPlatforms,
                ...selectedGenres,
                offersOnly,
                sortValue
            ].filter(Boolean).length;

            const countElement = document.getElementById('activeFiltersCount');
            const countText = document.getElementById('filtersCount');
            
            if (activeFilters > 0) {
                countText.textContent = activeFilters;
                countElement.classList.remove('hidden');
            } else {
                countElement.classList.add('hidden');
            }
        }

        function clearAllFilters() {
            searchInput.value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.querySelectorAll('.platform-filter, .genre-filter').forEach(cb => cb.checked = false);
            document.getElementById('offersFilter').checked = false;
            sortSelect.value = '';
            applyFilters();
            showNotification('Filtros limpiados', 'success');
        }

        // Event listeners
        searchInput.addEventListener('input', applyFilters);
        clearFiltersBtn.addEventListener('click', clearAllFilters);
        document.querySelectorAll('.platform-filter, .genre-filter').forEach(cb => cb.addEventListener('change', applyFilters));
        document.getElementById('offersFilter').addEventListener('change', applyFilters);
        document.getElementById('applyPriceFilter').addEventListener('click', applyFilters);
        sortSelect.addEventListener('change', applyFilters);

        // Event listeners para modales
        closeCartModal.addEventListener('click', () => {
            cartModal.classList.add('hidden');
        });

        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                cartModal.classList.add('hidden');
            }
        });

        closeFavoritesModal.addEventListener('click', () => {
            favoritesModal.classList.add('hidden');
        });

        favoritesModal.addEventListener('click', (e) => {
            if (e.target === favoritesModal) {
                favoritesModal.classList.add('hidden');
            }
        });

        closeComparisonModal.addEventListener('click', () => {
            comparisonModal.classList.add('hidden');
        });

        comparisonModal.addEventListener('click', (e) => {
            if (e.target === comparisonModal) {
                comparisonModal.classList.add('hidden');
            }
        });

        // Botones del header
        cartBtn.addEventListener('click', () => {
            renderCartModal();
            cartModal.classList.remove('hidden');
        });

        favoritesBtn.addEventListener('click', () => {
            renderFavoritesModal();
            favoritesModal.classList.remove('hidden');
        });

        comparisonBtn.addEventListener('click', () => {
            if (comparisonItems.length > 0) {
                renderComparisonModal();
                comparisonModal.classList.remove('hidden');
            } else {
                showNotification('Selecciona productos para comparar', 'error');
            }
        });

        // Inicialización
        renderProducts();
        updateCounters();
        renderCartModal();
        renderFavoritesModal();

        // --- MODAL DETALLES PRODUCTO ---
        function mostrarDetallesProductoPorId(id) {
          const product = products.find(p => p.id == id);
          if (!product) return;
          document.getElementById('modalNombre').textContent = product.name;
          document.getElementById('modalSubtitulo').textContent = product.subtitle || '';
          document.getElementById('modalPrecio').textContent = 'Precio: ' + formatPrice(product.price);
          document.getElementById('modalImg').src = product.image;
          document.getElementById('modalPlataformas').textContent = product.platform ? 'Plataformas: ' + product.platform.join(', ') : '';
          document.getElementById('modalGeneros').textContent = product.genre ? 'Género: ' + product.genre.join(', ') : '';
          document.getElementById('modalDetalles').classList.remove('hidden');
        }
        mainContainer.addEventListener('click', function(e) {
          if (e.target.tagName === 'IMG' && e.target.dataset.id && !e.target.hasAttribute('onclick')) {
            mostrarDetallesProductoPorId(e.target.dataset.id);
          }
        });
        const cerrarModalDetalles = document.getElementById('cerrarModalDetalles');
        if (cerrarModalDetalles) {
          cerrarModalDetalles.onclick = function() {
            document.getElementById('modalDetalles').classList.add('hidden');
          }
        }
        document.getElementById('modalDetalles').addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.add('hidden');
          }
        });
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            document.getElementById('modalDetalles').classList.add('hidden');
          }
        });
        // --- FIN MODAL DETALLES PRODUCTO ---

        // Función para abrir página de detalles de videojuegos
        function openProductDetails(productId, productName, productPrice, productImage) {
            try {
                // Redirect directly to the details page with the product ID
                const detailUrl = `juego-detalle.html?id=${productId}`;
                // Redirect to the details page
                window.location.href = detailUrl;
            } catch (error) {
                console.error('Error opening product details:', error);
            }
        }

    </script>
</body>

</html>
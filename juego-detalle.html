<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Detalles del Videojuego</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="responsive.css">
    <script src="mobile-nav.js"></script>
    <script src="mobile-config.js"></script>
    <style>
        body {
            background-image: url('https://img.freepik.com/vector-premium/fondo-vector-monocromo-blanco-abstracto-folleto-diseno-folleto-sitio-web-fondo-pantalla-blanco-geometrico-pagina-inicio-presentacion-certificado_249611-5879.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .btn-primary {
            background: #3483fa;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #2968c8;
        }

        .btn-secondary {
            background: #fff;
            border: 1px solid #3483fa;
            color: #3483fa;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
        }

        .thumbnail {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .thumbnail:hover {
            transform: scale(1.02);
        }

        .thumbnail.active {
            border: 2px solid #3483fa;
        }

        .price-badge {
            background: #39b54a;
        }

        .star-rating {
            color: #3483fa;
        }

        .mercado-libre-blue {
            color: #3483fa;
        }

        .mercado-libre-green {
            color: #39b54a;
        }

        .mercado-libre-gray {
            color: #666;
        }

        .mercado-libre-light-gray {
            color: #999;
        }

        .mercado-libre-bg {
            background: #f5f5f5;
        }

        .mercado-libre-card {
            background: #fff;
            border: 1px solid #e6e6e6;
            border-radius: 8px;
        }

        .mercado-libre-price {
            font-family: 'Proxima Nova', -apple-system, 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif;
        }

        .mercado-libre-sticky {
            position: sticky;
            top: 20px;
        }

        .product-image {
            object-fit: contain;
        }

        .related-product-card {
            background: #fff;
            border: 1px solid #e6e6e6;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }

        .related-product-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .related-product-card:active {
            transform: translateY(0);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .related-product-image {
            object-fit: contain;
            background: #f8f9fa;
        }

        .error-container {
            text-align: center;
            padding: 4rem 2rem;
        }

        .error-icon {
            font-size: 4rem;
            color: #e53e3e;
            margin-bottom: 1rem;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3483fa;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body class="mercado-libre-bg">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-purple-600 py-6 shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-3">
                <div class="flex items-center justify-between header-content">
                    <!-- Logo y título -->
                    <div class="flex items-center space-x-4">
                        <img src="logo.png" alt="Digital Swap Logo" class="h-8 w-auto">
                        <h1 class="text-2xl font-bold text-white hidden-mobile">Digital Swap</h1>
                        <h1 class="text-lg font-bold text-white visible-mobile">DS</h1>
                    </div>
                    
                    <!-- Navegación -->
                    <nav class="hidden md:flex items-center space-x-6 nav">
                        <a href="telefon.html" class="text-white hover:text-blue-200 transition-colors nav-link">
                            <i class="fas fa-mobile-alt mr-1"></i><span class="hidden-mobile">Teléfonos</span>
                        </a>
                        <a href="audifonos.html" class="text-white hover:text-blue-200 transition-colors nav-link">
                            <i class="fas fa-headphones mr-1"></i><span class="hidden-mobile">Audífonos</span>
                        </a>
                        <a href="consilaju.html" class="text-white hover:text-blue-200 transition-colors nav-link">
                            <i class="fas fa-tv mr-1"></i><span class="hidden-mobile">Consolas</span>
                        </a>
                        <a href="Smartwat.html" class="text-white hover:text-blue-200 transition-colors nav-link">
                            <i class="fas fa-clock mr-1"></i><span class="hidden-mobile">Smartwatches</span>
                        </a>
                    </nav>

                    <div class="flex items-center space-x-4">
                        <button id="shareBtn" class="text-white hover:text-blue-200 transition-colors p-2">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <button id="favoriteBtn" class="text-white hover:text-red-200 transition-colors p-2">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button id="cartBtn" class="relative text-white hover:text-blue-200 transition-colors p-2">
                            <i class="fas fa-shopping-cart"></i>
                            <span id="cartCount"
                                class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-4 px-4">
            <!-- Loading State -->
            <div id="loading-state" class="text-center">
                <div class="loading-spinner"></div>
                <p class="text-gray-600">Cargando detalles del juego...</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="error-container hidden">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Juego no encontrado</h2>
                <p class="text-gray-600 mb-4">El juego que buscas no está disponible o no existe.</p>
                <button onclick="goBack()" class="btn-primary px-6 py-2 text-white font-medium rounded">
                    Volver al catálogo
                </button>
            </div>

            <!-- Product Content -->
            <div id="product-content" class="hidden">
                <!-- Breadcrumb -->
                <div class="text-gray-600 text-sm mb-4">
                    <span>Inicio > </span>
                    <a href="Juegosv.html" class="text-blue-600 hover:underline">Videojuegos > </a>
                    <a href="Juegosv.html" class="text-blue-600 hover:underline">Juegos > </a>
                    <span id="product-breadcrumb" class="text-gray-900">Tekken 8</span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 product-details">

                    <!-- Left Column: Product Gallery -->
                    <div class="lg:col-span-1">
                        <div class="space-y-4">
                            <!-- Main Image Gallery -->
                            <div class="mercado-libre-card p-4 product-gallery">
                                <!-- Main Image Container -->
                                <div class="relative mb-4">
                                    <img id="main-image" src="" alt="Videojuego" class="w-full h-80 product-image rounded main-image">
                                    <div class="absolute top-2 right-2">
                                        <button class="bg-white rounded-full p-2 shadow-md hover:shadow-lg transition-all">
                                            <i class="fas fa-expand-arrows-alt text-gray-600 text-sm"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Thumbnail Gallery -->
                                <div class="flex space-x-2 overflow-x-auto thumbnail-gallery">
                                    <div id="thumbnail-container" class="flex space-x-2">
                                        <!-- Thumbnails will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Related Products -->
                            <div class="mercado-libre-card p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-900">Juegos relacionados</h3>
                                        <p class="text-sm mercado-libre-gray">Promocionado</p>
                                    </div>
                                    <button class="bg-white rounded-full p-3 shadow-md hover:shadow-lg transition-all">
                                        <i class="fas fa-chevron-right text-blue-600"></i>
                                    </button>
                                </div>

                                <div class="flex space-x-3 overflow-x-auto">
                                    <div id="related-products-container" class="flex space-x-3">
                                        <!-- Related products will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Center Column: Product Details -->
                    <div class="lg:col-span-1">
                        <div class="space-y-4">
                            <!-- Product Status & Sales -->
                            <div class="mercado-libre-card p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-sm mercado-libre-gray">Nuevo | +1.5mil vendidos</span>
                                    </div>
                                </div>

                                <!-- Product Title -->
                                <h1 id="product-title" class="text-xl font-normal text-gray-900 mb-2"></h1>

                                <!-- Rating -->
                                <div class="flex items-center space-x-2 mb-3">
                                    <div class="flex items-center">
                                        <span class="star-rating text-sm">★★★★☆</span>
                                        <span class="mercado-libre-blue font-medium ml-1 text-sm">4.7</span>
                                    </div>
                                    <span class="mercado-libre-light-gray text-sm">(89)</span>
                                </div>
                            </div>

                            <!-- Pricing -->
                            <div class="mercado-libre-card p-4">
                                <div class="flex items-center space-x-3 mb-2">
                                    <span id="original-price" class="text-lg mercado-libre-light-gray line-through"></span>
                                    <span id="current-price"
                                        class="text-3xl mercado-libre-price font-light text-gray-900"></span>
                                    <span class="price-badge text-white px-2 py-1 rounded text-xs font-medium">20%
                                        OFF</span>
                                </div>
                                <div class="space-y-1">
                                    <p class="text-sm mercado-libre-gray">24 meses de $124.95</p>
                                    <p class="text-sm mercado-libre-gray">IVA incluido</p>
                                    <a href="#" class="text-sm mercado-libre-blue hover:underline">Ver los medios de
                                        pago</a>
                                </div>
                            </div>

                            <!-- Platform & Genre Selection -->
                            <div class="mercado-libre-card p-4">
                                <label class="block text-sm font-medium mercado-libre-gray mb-2">Plataforma: <span
                                        id="selected-platform" class="mercado-libre-blue">PlayStation 5</span></label>
                                <div class="flex items-center space-x-3">
                                    <img id="platform-thumbnail" src="" alt="Plataforma seleccionada"
                                        class="w-16 h-16 object-cover rounded border-2 border-blue-500">
                                </div>
                                <div class="mt-3">
                                    <label class="block text-sm font-medium mercado-libre-gray mb-2">Género: <span
                                            id="selected-genre" class="mercado-libre-blue">Lucha</span></label>
                                </div>
                            </div>

                            <!-- Product Specifications -->
                            <div class="mercado-libre-card p-4">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Lo que tienes que saber de este juego
                                </h3>
                                <div id="product-features" class="space-y-2">
                                    <!-- Features will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Purchase Options (Sticky) -->
                    <div class="lg:col-span-1">
                        <div class="mercado-libre-sticky purchase-info">
                            <div class="space-y-4">
                                <!-- Delivery Information -->
                                <div class="mercado-libre-card p-4">
                                    <div class="space-y-3">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-truck mercado-libre-green text-sm"></i>
                                            <span class="mercado-libre-green font-medium text-sm">Llega gratis mañana</span>
                                        </div>
                                        <p class="text-xs mercado-libre-gray">Comprando dentro de las próximas 6 h 45 min
                                        </p>
                                        <a href="#" class="text-xs mercado-libre-blue hover:underline">Más formas de
                                            entrega</a>

                                        <div class="flex items-center space-x-2 mt-3">
                                            <i class="fas fa-map-marker-alt mercado-libre-green text-sm"></i>
                                            <span class="mercado-libre-green font-medium text-sm">Retira gratis a partir de
                                                mañana en correos y otros puntos</span>
                                        </div>
                                        <p class="text-xs mercado-libre-gray">Comprando dentro de las próximas 1 h 30 min
                                        </p>
                                        <a href="#" class="text-xs mercado-libre-blue hover:underline">Ver en el mapa</a>
                                    </div>
                                </div>

                                <!-- Stock Availability -->
                                <div class="mercado-libre-card p-4">
                                    <div class="space-y-3">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-check-circle mercado-libre-green text-sm"></i>
                                            <span class="mercado-libre-green font-medium text-sm">Stock disponible</span>
                                        </div>
                                        <p class="text-xs mercado-libre-gray">Almacenado y enviado por <i
                                                class="fas fa-bolt mercado-libre-green"></i> FULL</p>

                                        <div class="flex items-center justify-between">
                                            <label class="text-sm mercado-libre-gray">
                                                Cantidad: <span id="quantity-display" class="mercado-libre-blue">1
                                                    unidad</span> (+15 disponibles)
                                            </label>
                                            <div class="flex items-center space-x-2">
                                                <button id="quantity-minus"
                                                    class="w-6 h-6 bg-gray-200 rounded flex items-center justify-center hover:bg-gray-300">
                                                    <i class="fas fa-minus text-gray-600 text-xs"></i>
                                                </button>
                                                <span id="quantity-value" class="w-8 text-center font-medium">1</span>
                                                <button id="quantity-plus"
                                                    class="w-6 h-6 bg-gray-200 rounded flex items-center justify-center hover:bg-gray-300">
                                                    <i class="fas fa-plus text-gray-600 text-xs"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="mercado-libre-card p-4">
                                    <div class="space-y-3">
                                        <button id="buy-now-btn"
                                            class="btn-primary w-full py-4 px-6 text-white font-medium rounded text-sm btn">
                                            Comprar ahora
                                        </button>
                                        <button id="add-to-cart-btn"
                                            class="btn-secondary w-full py-4 px-6 font-medium rounded text-sm btn">
                                            Agregar al carrito
                                        </button>
                                    </div>
                                </div>

                                <!-- Seller Info -->
                                <div class="mercado-libre-card p-4">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-sm mercado-libre-gray">Vendido por</span>
                                        <a href="#" class="text-sm mercado-libre-blue hover:underline"
                                            id="seller-name-bottom"></a>
                                    </div>
                                    <p class="text-xs mercado-libre-gray">MercadoLíder | +25mil ventas</p>
                                </div>

                                <!-- Guarantees -->
                                <div class="mercado-libre-card p-4">
                                    <div class="space-y-2">
                                        <div class="flex items-start space-x-2">
                                            <i class="fas fa-undo text-green-500 text-xs mt-1"></i>
                                            <p class="text-xs mercado-libre-gray">
                                                <span class="font-medium">Devolución gratis.</span> Tienes 30 días desde que
                                                lo recibes.
                                            </p>
                                        </div>
                                        <div class="flex items-start space-x-2">
                                            <i class="fas fa-shield-alt text-green-500 text-xs mt-1"></i>
                                            <p class="text-xs mercado-libre-gray">
                                                <span class="font-medium">Compra Protegida,</span> recibe el producto que
                                                esperabas o te devolvemos tu dinero.
                                            </p>
                                        </div>
                                        <div class="flex items-start space-x-2">
                                            <i class="fas fa-medal text-green-500 text-xs mt-1"></i>
                                            <p class="text-xs mercado-libre-gray">
                                                <span class="font-medium">12 meses de garantía de fábrica.</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Product data for games
        const products = [
            {
                id: 1,
                name: "Tekken 8",
                subtitle: "Lucha - PlayStation 5 / Xbox Series X",
                price: 2999,
                originalPrice: 3499,
                weeklyPrice: 150,
                image: "Imagenes/Tekken.png",
                images: [
                    "Imagenes/juego.png",
                    "Imagenes/jueg.png",
                    "Imagenes/jue.png"
                ],
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["Lucha"],
                features: [
                    "Plataforma: PS5.",
                    "Edición: Standard.",
                    "Formato: Físico.",
                    "Edición Estándar",
                    "Incluye 1 disco de videojuego",
                    "Clasificación Mexicana (B15)",
                    "Región Latinoamérica",
                    "Género: Acción, Peleas",
                    "Tamaño del archivo aproximado: 90 GB",
                    "Idiomas compatibles: Inglés, Japonés. Subtítulos: Español, Inglés",
                    "Número de jugadores: En una consola (1-2), en línea (2-16)"
                ],
                seller: "Bandai Namco Store",
                type: "game"
            },
            {
                id: 2,
                name: "Gran Turismo 7",
                subtitle: "Carreras - PlayStation 5",
                price: 1999,
                originalPrice: 2499,
                weeklyPrice: 150,
                image: "Imagenes/Gran .png",
                images: [
                    "Imagenes/cart.png",
                    "Imagenes/cartt.png",
                    "Imagenes/carrp.png",
                    "Imagenes/carp.png"
                ],
                platform: ["PlayStation 5"],
                genre: ["Carreras"],
                features: [
                    "Simulación de carreras realista.",
                    "Más de 400 coches licenciados.",
                    "Formato: Físico.",
                    "Edición: Estándar",
                    "Incluye: 1 disco de videojuego",
                    "Clasificación: ESRB E",
                    "Región: Latinoamérica",
                    "Género: Carreras",
                    "Idiomas compatibles: Multilenguaje"
                ],
                seller: "Sony Store",
                type: "game"
            },
            {
                id: 3,
                name: "Doom Eternal",
                subtitle: "Shooter - PlayStation 5 / Xbox Series X",
                price: 2599,
                originalPrice: 2999,
                weeklyPrice: 130,
                image: "Imagenes/Doom.png",
                images: [
                    "Imagenes/doo.png",
                    "Imagenes/don.png",
                    "Imagenes/doing.png",
                    "Imagenes/dong.png"
                ],
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["Shooter"],
                features: [
                    "Shooter en primera persona intenso.",
                    "Combate contra demonios épico.",
                    "Armas y equipamiento mejorados.",
                    "Modo campaña extenso.",
                    "Modo multijugador competitivo.",
                    "Gráficos de nueva generación.",
                    "Compatibilidad con 120 FPS.",
                    "Modo invasión demoníaca.",
                    "Personalización del Slayer."
                ],
                seller: "Bethesda Store",
                type: "game"
            },
            {
                id: 4,
                name: "Assassin's Creed Mirage",
                subtitle: "Acción / Sigilo - PlayStation 5 / Xbox Series X",
                price: 499,
                originalPrice: 999,
                weeklyPrice: 29,
                image: "Imagenes/mira.png",
                images: [
                    "Imagenes/Tekken.png",
                    "Imagenes/Gran .png",
                    "Imagenes/Doom.png",
                    "Imagenes/Fantasy XVI.png"
                ],
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["Acción", "Aventura"],
                features: [
                    "Aventura de acción y sigilo.",
                    "Ambientado en Bagdad medieval.",
                    "Sistema de parkour mejorado.",
                    "Sigilo y combate equilibrado.",
                    "Historia narrativa envolvente.",
                    "Gráficos de nueva generación.",
                    "Modo exploración libre.",
                    "Personalización del personaje.",
                    "Contenido descargable incluido."
                ],
                seller: "Ubisoft Store",
                type: "game"
            },
            {
                id: 5,
                name: "Final Fantasy XVI",
                subtitle: "RPG / Aventura - PlayStation 5",
                price: 3199,
                originalPrice: 3199,
                weeklyPrice: 51,
                image: "Imagenes/Fantasy XVI.png",
                images: [
                    "Imagenes/fi.png",
                    "Imagenes/fin.png",
                    "Imagenes/fina.png"
                    
                ],
                platform: ["PlayStation 5"],
                genre: ["RPG", "Aventura"],
                features: [
                    "RPG de acción épico.",
                    "Historia narrativa envolvente.",
                    "Combate real-time espectacular.",
                    "Mundo abierto fantástico.",
                    "Gráficos cinematográficos.",
                    "Banda sonora orquestal.",
                    "Modo historia extenso.",
                    "Personalización de Clive.",
                    "Contenido post-lanzamiento."
                ],
                seller: "Square Enix Store",
                type: "game"
            },
            {
                id: 6,
                name: "Pokémon Scarlet & Violet",
                subtitle: "RPG - Nintendo Switch",
                price: 2799,
                originalPrice: 2799,
                weeklyPrice: 49,
                image: "Imagenes/Violet.png",
                images: [
                    "Imagenes/po.png",
                    "Imagenes/poo.png",
                    "Imagenes/pol.png"
                ],
                platform: ["Nintendo Switch"],
                genre: ["RPG"],
                features: [
                    "RPG de mundo abierto Pokémon.",
                    "Nuevas regiones para explorar.",
                    "Más de 400 Pokémon.",
                    "Modo cooperativo local.",
                    "Battles online.",
                    "Personalización del entrenador.",
                    "Nuevos tipos de Pokémon.",
                    "Modo historia extenso.",
                    "Contenido descargable."
                ],
                seller: "Nintendo Store",
                type: "game"
            },
            {
                id: 7,
                name: "Hogwarts Legacy",
                subtitle: "RPG / Aventura - PlayStation 5 / Xbox Series X",
                price: 1899,
                originalPrice: 2499,
                weeklyPrice: 95,
                image: "Imagenes/accion.png",
                images: [
                    "Imagenes/hog.png",
                    "Imagenes/hooog.png",
                    "Imagenes/hogp.png",
                    "Imagenes/hj.png"

                ],
                platform: ["PlayStation 5", "Xbox Series X"],
                genre: ["RPG", "Aventura"],
                features: [
                    "RPG de mundo abierto mágico.",
                    "Ambientado en Hogwarts.",
                    "Sistema de magia completo.",
                    "Exploración libre del castillo.",
                    "Historia original del universo.",
                    "Personalización del estudiante.",
                    "Clases y actividades mágicas.",
                    "Combate con varitas.",
                    "Contenido post-lanzamiento."
                ],
                seller: "Warner Bros Store",
                type: "game"
            },
            {
                id: 8,
                name: "Mario Kart 8 Deluxe",
                subtitle: "Carreras - Nintendo Switch",
                price: 1599,
                originalPrice: 1599,
                weeklyPrice: 80,
                image: "Imagenes/karts.png",
                images: [
                    "Imagenes/mar.png",
                    "Imagenes/mars.png",
                    "Imagenes/marss.png",
                    "Imagenes/maet.png"
                ],
                platform: ["Nintendo Switch"],
                genre: ["Carreras"],
                features: [
                    "Carreras de karts multijugador.",
                    "Más de 40 personajes.",
                    "48 circuitos únicos.",
                    "Modo local hasta 4 jugadores.",
                    "Modo online competitivo.",
                    "Personalización de vehículos.",
                    "Power-ups clásicos.",
                    "Modo batalla incluido.",
                    "Contenido descargable."
                ],
                seller: "Nintendo Store",
                type: "game"
            }
        ];

        // Global variables
        let currentProduct = null;
        let currentQuantity = 1;
        let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
        let favoriteItems = JSON.parse(localStorage.getItem('favoriteItems')) || [];
        let activeNotifications = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            loadProductDetails();
            initializeEventListeners();
            updateCartCount();
            updateFavoriteStatus();
            
            // Verificar productos disponibles (sin debug)
            const product4 = products.find(p => p.id === 4);
            if (!product4) {
                console.warn('Producto 4 no encontrado en la lista');
            }
        });

        function loadProductDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (!productId) {
                showError();
                return;
            }

            currentProduct = products.find(p => p.id == productId);
            if (!currentProduct) {
                showError();
                return;
            }

            // Hide loading, show content
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('product-content').classList.remove('hidden');

            populateProductDetails();
            loadThumbnails();
            loadRelatedProducts();
        }

        function showError() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('error-state').classList.remove('hidden');
        }

        function populateProductDetails() {
            // Main product info
            document.getElementById('product-title').textContent = currentProduct.name;
            
            // Set main image with error handling
            const mainImage = document.getElementById('main-image');
            mainImage.src = currentProduct.image;
            mainImage.alt = currentProduct.name;
            mainImage.onerror = function() {
                this.src = 'Imagenes/juegos.png'; // Fallback image
            };

            // Breadcrumb
            document.getElementById('product-breadcrumb').textContent = currentProduct.name;

            // Pricing
            document.getElementById('current-price').textContent = formatPrice(currentProduct.price);
            document.getElementById('original-price').textContent = formatPrice(currentProduct.originalPrice);

            // Platform
            document.getElementById('selected-platform').textContent = currentProduct.platform.join(', ');
            
            // Platform thumbnail with error handling
            const platformThumbnail = document.getElementById('platform-thumbnail');
            platformThumbnail.src = currentProduct.image;
            platformThumbnail.onerror = function() {
                this.src = 'Imagenes/juegos.png'; // Fallback image
            };

            // Genre
            document.getElementById('selected-genre').textContent = currentProduct.genre.join(', ');

            // Seller
            document.getElementById('seller-name-bottom').textContent = currentProduct.seller;

            // Features
            const featuresContainer = document.getElementById('product-features');
            featuresContainer.innerHTML = currentProduct.features.map(feature =>
                `<p class="text-sm mercado-libre-gray">• ${feature}</p>`
            ).join('');

            // Update page title
            document.title = `${currentProduct.name} - Detalles del Videojuego`;
        }

        function loadThumbnails() {
            const container = document.getElementById('thumbnail-container');
            container.innerHTML = '';

            // Add main image as first thumbnail
            const thumbnails = [currentProduct.image, ...currentProduct.images];

            thumbnails.forEach((image, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = `thumbnail w-16 h-16 rounded border ${index === 0 ? 'active' : 'border-gray-300'}`;
                thumbnail.onclick = () => selectThumbnail(image, thumbnail);

                const img = document.createElement('img');
                img.src = image;
                img.alt = `${currentProduct.name} ${index + 1}`;
                img.className = 'w-full h-full object-cover rounded';
                img.onerror = function() {
                    this.src = 'Imagenes/juegos.png'; // Fallback image
                };

                thumbnail.appendChild(img);
                container.appendChild(thumbnail);
            });
        }

        function selectThumbnail(imageSrc, thumbnailElement) {
            // Update main image
            const mainImage = document.getElementById('main-image');
            mainImage.src = imageSrc;
            mainImage.onerror = function() {
                this.src = 'Imagenes/juegos.png'; // Fallback image
            };

            // Update active thumbnail
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
                thumb.classList.add('border-gray-300');
            });
            thumbnailElement.classList.add('active');
            thumbnailElement.classList.remove('border-gray-300');
        }

        function loadRelatedProducts() {
            const container = document.getElementById('related-products-container');
            container.innerHTML = '';

            // Get related products (excluding current product)
            const relatedProducts = products.filter(p => p.id !== currentProduct.id).slice(0, 4);

            relatedProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'related-product-card p-3 flex-shrink-0 w-48 cursor-pointer';
                
                const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                const monthlyPayment = Math.round(product.price / 24);

                productCard.innerHTML = `
                    <div class="flex flex-col space-y-2">
                        <div class="w-full h-32 bg-gray-50 rounded flex items-center justify-center">
                            <img src="${product.image}" alt="${product.name}" class="related-product-image w-full h-full rounded" onerror="this.src='Imagenes/juegos.png'">
                        </div>
                        <div class="space-y-1">
                            <h4 class="text-sm font-medium text-gray-900 line-clamp-2">${product.name}</h4>
                            <div class="space-y-1">
                                <p class="text-base font-bold text-gray-900">${formatPrice(product.price)}</p>
                                <p class="text-xs mercado-libre-light-gray line-through">${formatPrice(product.originalPrice)}</p>
                                <p class="text-xs mercado-libre-green">${discount}% OFF</p>
                                <p class="text-xs mercado-libre-gray">24 meses de $${monthlyPayment}</p>
                                <p class="text-xs mercado-libre-green"><i class="fas fa-bolt"></i> Envío gratis FULL</p>
                            </div>
                        </div>
                    </div>
                `;

                // Add click event listener after creating the element
                productCard.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Clicked on product:', product.name, 'ID:', product.id);
                    openProductDetails(product.id, product.name, product.price, product.image);
                });

                container.appendChild(productCard);
            });
        }

        function openProductDetails(productId, productName, productPrice, productImage) {
            try {
                // Validar que el producto existe
                const product = products.find(p => p.id === productId);
                if (!product) {
                    console.warn('Producto no encontrado:', productId);
                    showNotification('Producto no encontrado', 'error');
                    return;
                }
                
                // Redirigir a la página de detalles
                const detailUrl = `juego-detalle.html?id=${productId}`;
                window.location.href = detailUrl;
            } catch (error) {
                console.error('Error opening product details:', error);
                showNotification('Error al abrir detalles del producto', 'error');
            }
        }

        function initializeEventListeners() {
            // Quantity buttons
            document.getElementById('quantity-minus').addEventListener('click', () => updateQuantity(-1));
            document.getElementById('quantity-plus').addEventListener('click', () => updateQuantity(1));

            // Action buttons
            document.getElementById('buy-now-btn').addEventListener('click', buyNow);
            document.getElementById('add-to-cart-btn').addEventListener('click', addToCart);

            // Header buttons
            document.getElementById('shareBtn').addEventListener('click', shareProduct);
            document.getElementById('favoriteBtn').addEventListener('click', toggleFavorite);
            document.getElementById('cartBtn').addEventListener('click', showCart);
        }

        function updateQuantity(change) {
            const newQuantity = Math.max(1, currentQuantity + change);
            currentQuantity = newQuantity;

            document.getElementById('quantity-value').textContent = newQuantity;
            document.getElementById('quantity-display').textContent = `${newQuantity} unidad${newQuantity > 1 ? 'es' : ''}`;
        }

        function addToCart() {
            if (!currentProduct) return;

            const existingItem = cartItems.find(item => item.id === currentProduct.id);
            if (existingItem) {
                existingItem.quantity += currentQuantity;
            } else {
                cartItems.push({
                    id: currentProduct.id,
                    name: currentProduct.name,
                    price: currentProduct.price,
                    image: currentProduct.image,
                    quantity: currentQuantity
                });
            }

            localStorage.setItem('cartItems', JSON.stringify(cartItems));
            updateCartCount();
            showNotification('Juego agregado al carrito', 'success');
        }

        function buyNow() {
            if (!currentProduct) return;

            // Agregar al carrito primero
            addToCart();
            
            // Agregar al historial de compras
            agregarAlHistorialCompras();
            
            // Simular proceso de compra
            showNotification('Procesando compra...', 'info');
            
            setTimeout(() => {
                showNotification('¡Compra realizada con éxito!', 'success');
                
                // Redirigir a la página de productos después de un breve delay
                setTimeout(() => {
                    window.location.href = 'productos.html';
                }, 2000);
            }, 1500);
        }

        function agregarAlHistorialCompras() {
            try {
                // Obtener historial existente
                const historial = JSON.parse(localStorage.getItem('historialCompras') || '[]');
                
                // Crear nueva compra
                const nuevaCompra = {
                    fecha: new Date().toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }),
                    total: currentProduct.price * currentQuantity,
                    productos: [{
                        nombre: currentProduct.name,
                        precio: currentProduct.price,
                        imagen: currentProduct.image,
                        cantidad: currentQuantity
                    }]
                };
                
                // Agregar al inicio del historial
                historial.unshift(nuevaCompra);
                
                // Limitar a 10 compras más recientes
                if (historial.length > 10) {
                    historial.splice(10);
                }
                
                // Guardar en localStorage
                localStorage.setItem('historialCompras', JSON.stringify(historial));
                
            } catch (error) {
                console.error('Error al agregar al historial:', error);
            }
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN'
            }).format(price);
        }

        function showNotification(message, type = 'info') {
            // Remove existing notifications to prevent overlapping
            activeNotifications.forEach(notification => {
                if (notification && notification.parentNode) {
                    notification.remove();
                }
            });
            activeNotifications = [];

            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded shadow-lg transform transition-all duration-300 ${type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                    'bg-blue-500 text-white'
                }`;
            notification.textContent = message;

            // Add to active notifications array
            activeNotifications.push(notification);
            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                if (notification && notification.parentNode) {
                    notification.remove();
                    activeNotifications = activeNotifications.filter(n => n !== notification);
                }
            }, 3000);
        }

        function goBack() {
            // Try to go back to the previous page, if not available, go to games page
            if (document.referrer && document.referrer.includes('juego-detalle.html')) {
                window.history.back();
            } else {
                window.location.href = 'Juegosv.html';
            }
        }

        // Header button functions
        function shareProduct() {
            if (!currentProduct) return;

            if (navigator.share) {
                navigator.share({
                    title: currentProduct.name,
                    text: `Mira este juego: ${currentProduct.name} - ${formatPrice(currentProduct.price)}`,
                    url: window.location.href
                }).catch(err => {
                    console.log('Error sharing:', err);
                    copyToClipboard(window.location.href);
                });
            } else {
                copyToClipboard(window.location.href);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Enlace copiado al portapapeles', 'success');
            }).catch(() => {
                showNotification('Error al copiar enlace', 'error');
            });
        }

        function toggleFavorite() {
            if (!currentProduct) return;

            const isFavorite = favoriteItems.some(item => item.id === currentProduct.id);

            if (isFavorite) {
                favoriteItems = favoriteItems.filter(item => item.id !== currentProduct.id);
                showNotification('Juego removido de favoritos', 'info');
            } else {
                favoriteItems.push({
                    id: currentProduct.id,
                    name: currentProduct.name,
                    price: currentProduct.price,
                    image: currentProduct.image
                });
                showNotification('Juego agregado a favoritos', 'success');
            }

            localStorage.setItem('favoriteItems', JSON.stringify(favoriteItems));
            updateFavoriteStatus();
        }

        function updateFavoriteStatus() {
            if (!currentProduct) return;

            const favoriteBtn = document.getElementById('favoriteBtn');
            const isFavorite = favoriteItems.some(item => item.id === currentProduct.id);

            if (isFavorite) {
                favoriteBtn.classList.add('text-red-500');
                favoriteBtn.classList.remove('text-gray-600');
            } else {
                favoriteBtn.classList.remove('text-red-500');
                favoriteBtn.classList.add('text-gray-600');
            }
        }

        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            const totalItems = cartItems.reduce((total, item) => total + item.quantity, 0);

            if (totalItems > 0) {
                cartCount.textContent = totalItems;
                cartCount.classList.remove('hidden');
            } else {
                cartCount.classList.add('hidden');
            }
        }

        function showCart() {
            if (cartItems.length === 0) {
                showNotification('Tu carrito está vacío', 'info');
                return;
            }

            const totalItems = cartItems.reduce((total, item) => total + item.quantity, 0);
            const totalPrice = cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);

            showNotification(`Carrito: ${totalItems} productos - Total: ${formatPrice(totalPrice)}`, 'info');
        }

        // Test function for product 4
        function testProduct4() {
            const product4 = products.find(p => p.id === 4);
            if (product4) {
                console.log('Product 4 found:', product4.name);
                openProductDetails(4, product4.name, product4.price, product4.image);
            } else {
                console.error('Product 4 not found');
            }
        }
    </script>
</body>

</html>